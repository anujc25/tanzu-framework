---
apiVersion: run.tanzu.vmware.com/v1alpha3
kind: TanzuKubernetesRelease
metadata:
  name: v1.22.3
spec:
  version: v1.22.3
  kubernetes:
    version: v1.22.3
    imageRepository: foo
  osImages: []
  bootstrapPackages: []

---
apiVersion: cluster.x-k8s.io/v1beta1
kind: Cluster
metadata:
  name: test-cluster-tcbt
  namespace: default
  labels:
    tkg.tanzu.vmware.com/cluster-name: test-cluster-tcbt
    tanzuKubernetesRelease: v1.22.3
---
apiVersion: run.tanzu.vmware.com/v1alpha3
kind: ClusterBootstrapTemplate
metadata:
  name: v1.22.3
  namespace: tkg-system
spec:
  kapp:
    refName: kapp-controller.tanzu.vmware.com.0.30.0
    valuesFrom:
      providerRef:
        apiGroup: run.tanzu.vmware.com
        kind: KappControllerConfig
        name: test-cluster-tcbt-kapp-controller-config
  additionalPackages:
    - refName: foobar.example.com.1.17.2
      valuesFrom:
        providerRef:
          apiGroup: run.tanzu.vmware.com
          kind: FooBar
          name: example-foo

---
apiVersion: run.tanzu.vmware.com/v1alpha3
kind: KappControllerConfig
metadata:
  name: test-cluster-tcbt-kapp-controller-config
  namespace: tkg-system
spec:
  namespace: test-ns
  kappController:
    createNamespace: true
    globalNamespace: tanzu-package-repo-global
    deployment:
      concurrency: 4
      hostNetwork: true
      priorityClassName: system-cluster-critical
      apiPort: 10100
      metricsBindAddress: "0"
      tolerations:
        - key: CriticalAddonsOnly
          operator: Exists
        - effect: NoSchedule
          key: node-role.kubernetes.io/master
        - effect: NoSchedule
          key: node.kubernetes.io/not-ready
        - effect: NoSchedule
          key: node.cloudprovider.kubernetes.io/uninitialized
          value: "true"

---
apiVersion: run.tanzu.vmware.com/v1alpha1
kind: FooBar
metadata:
  name: example-foo
  namespace: tkg-system
spec:
  foo: bar
---
apiVersion: data.packaging.carvel.dev/v1alpha1
kind: Package
metadata:
  name: foobar.example.com.1.17.2
  namespace: default
spec:
  refName: foobar
  version: 1.17.2+vmware.1-tkg.1
  releasedAt: "2021-05-13T18:00:00Z"
  releaseNotes: foobar 1.17.2
  capacityRequirementsDescription: Varies significantly based on cluster size. This should be tuned based on observed usage.
  valuesSchema:
    openAPIv3:
      title: foobar.example.com.1.17.2+vmware.1-tkg.1 values schema
      properties:
        namespace:
          type: string
          description: The namespace in which to deploy fluent-bit.
          default: tanzu-system-logging
        fluent_bit:
          type: object
          description: fluent-bit Kubernetes configuration.
          properties:
            daemonset:
              type: object
              description: fluent-bit deployment related configuration
              properties:
                resources:
                  type: object
                  description: fluent-bit containers resource requirements (See Kubernetes OpenAPI Specification io.k8s.api.core.v1.ResourceRequirements)
                  additionalProperties: true
                podAnnotations:
                  type: object
                  description: fluent-bit deployments pod annotations
                  additionalProperties: string
                podLabels:
                  type: object
                  description: fluent-bit deployments pod labels
                  additionalProperties: string
            config:
              type: object
              description: The fluent-bit configuration. See https://docs.fluentbit.io/manual/administration/configuring-fluent-bit for more information.
              properties:
                service:
                  type: string
                  description: Configuration for Fluent Bit service, as a multiline YAML. See https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/configuration-file#config_section for more information.
                  default: default fluent-bit service config.
                outputs:
                  type: string
                  description: Configuration for Fluent Bit outputs, as a multiline YAML. See https://docs.fluentbit.io/manual/pipeline/outputs for more information.
                  default: standard output
                inputs:
                  type: string
                  description: Configuration for Fluent Bit inputs, as a multiline YAML. See https://docs.fluentbit.io/manual/pipeline/inputs for more information.
                  default: tail
                filters:
                  type: string
                  description: Configuration for Fluent Bit filters, as a multiline YAML. See https://docs.fluentbit.io/manual/pipeline/filters/ for more information.
                  default: default kubernetes filter
                parsers:
                  type: string
                  description: Configuration for Fluent Bit parsers, as a multiline YAML. See https://docs.fluentbit.io/manual/pipeline/parsers/ for more information.
                  default: json parser
                streams:
                  type: string
                  description: Content for Fluent Bit streams file, as a multiline YAML
                  default: null
                plugins:
                  type: string
                  description: Content for Fluent Bit plugins configuration file, as a multiline YAML
                  default: null
  licenses:
  - 'VMware''s End User License Agreement (Underlying OSS license: Apache License 2.0)'
  template:
    spec:
      fetch:
      - imgpkgBundle:
          image: projects-stg.registry.vmware.com/tkg/tkgextensions-dev/fluent-bit:v1.7.5_vmware.1-tkg.1
      template:
      - ytt:
          paths:
          - config/
          ignoreUnknownComments: true
      - kbld:
          paths:
          - '-'
          - .imgpkg/images.yml
      deploy:
      - kapp:
          rawOptions:
          - --wait-timeout=5m
          - --kube-api-qps=20
          - --kube-api-burst=30
---
apiVersion: data.packaging.carvel.dev/v1alpha1
kind: Package
metadata:
  name: kapp-controller.tanzu.vmware.com.0.30.0
  namespace: default
spec:
  refName: kapp-controller.tanzu.vmware.com
  version: 0.30.0+vmware.1-tkg.1
  releaseNotes: kapp-controller 0.30.0 https://github.com/vmware-tanzu/carvel-kapp-controller
  licenses:
    - 'VMwareâ€™s End User License Agreement (Underlying OSS license: Apache License 2.0)'
  template:
    spec:
      fetch:
        - imgpkgBundle:
            image: projects-stg.registry.vmware.com/tkg/tkgextensions-dev/packages/core/kapp-controller:v0.30.0_vmware.1-tkg.1
      template:
        - ytt:
            paths:
              - config/
            ignoreUnknownComments: true
        - kbld:
            paths:
              - '-'
              - .imgpkg/images.yml
      deploy:
        - kapp:
            rawOptions:
              - --wait-timeout=30s
              - --kube-api-qps=20
              - --kube-api-burst=30
  releasedAt: "2021-12-20T10:59:32Z"
  valuesSchema:
    openAPIv3:
      title: kapp-controller.tanzu.vmware.com.0.30.0+vmware.1-tkg.1 values schema
